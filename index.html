<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lyra the Wise - RPG WebApp</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="assets/Lyra_Token.png" type="image/png">
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&family=Grenze+Gotisch:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body class="medieval-theme cursor-sword-gold">

    <div id="app-overlay"></div>

    <header class="app-header">
        <div class="header-content">
            <div class="header-left">
                <div class="logo-container">
                    <img src="assets/Lyra_logo.png" alt="Lyra the Wise" class="header-logo">
                </div>
                <button id="home-btn" class="medieval-btn small icon-only" title="Início"><i
                        class="fas fa-home"></i></button>
                <div class="header-menu-container">
                    <button id="menu-btn" class="medieval-btn small"><i class="fas fa-bars"></i> Menu</button>
                    <div class="header-dropdown-content parchment">
                        <div class="dropdown-sections">
                            <div class="dropdown-column">
                                <h3><i class="fas fa-hammer"></i> Criação Arcaica</h3>
                                <button class="nav-btn" data-view="fichas"><i class="fas fa-user-shield"></i>
                                    Personagens</button>
                                <button class="nav-btn" data-view="monstros"><i class="fas fa-dragon"></i>
                                    Bestiário</button>
                                <button class="nav-btn" data-action="villain-gen"><i class="fas fa-mask"></i>
                                    Vilões</button>
                                <button class="nav-btn" data-action="npc-gen"><i class="fas fa-users-gear"></i>
                                    NPCs</button>
                                <button class="nav-btn" data-action="item-gen"><i class="fas fa-ring"></i> Itens
                                    Mágicos</button>
                            </div>
                            <div class="dropdown-column">
                                <h3><i class="fas fa-chess-board"></i> Mestre de Masmorras</h3>
                                <button class="nav-btn" data-action="gm-screen"><i class="fas fa-desktop"></i> Painel do
                                    Mestre</button>
                                <button class="nav-btn" data-action="campaign-mgnt"><i
                                        class="fas fa-map-location-dot"></i>
                                    Campanhas</button>
                                <button class="nav-btn" data-action="encounter-gen"><i class="fas fa-shield"></i>
                                    Encontros</button>
                                <button class="nav-btn" data-action="trap-gen"><i class="fas fa-skull-crossbones"></i>
                                    Armadilhas</button>
                                <button class="nav-btn" data-action="puzzle-gen"><i class="fas fa-puzzle-piece"></i>
                                    Puzzles</button>
                                <button class="nav-btn" data-action="treasure-gen"><i class="fas fa-coins"></i>
                                    Tesouros</button>
                            </div>
                            <div class="dropdown-column">
                                <h3><i class="fas fa-journal-whills"></i> Trama & Saber</h3>
                                <button class="nav-btn" data-view="chat"><i class="fas fa-comment-dots"></i> Fale com
                                    Lyra</button>
                                <button class="nav-btn" data-view="sessoes"><i class="fas fa-scroll"></i>
                                    Sessões</button>
                                <button class="nav-btn" data-action="scene-desc"><i class="fas fa-image"></i>
                                    Cenas</button>
                                <button class="nav-btn" data-action="plot-gen"><i
                                        class="fas fa-wand-magic-sparkles"></i> Tramas</button>
                                <button class="nav-btn" data-action="motivation-gen"><i class="fas fa-heart-pulse"></i>
                                    Motivações</button>
                                <button class="nav-btn" data-action="rules-search"><i class="fas fa-book-open"></i>
                                    Regras</button>
                                <button class="nav-btn" data-action="names-list"><i class="fas fa-list-ol"></i>
                                    Nomes</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="header-char-tracker" class="header-center hidden">
                <div class="header-token-wrapper">
                    <img id="header-token" src="assets/Lyra_Token.png" alt="Token">
                </div>
                <div id="header-char-info" class="tracker-info">
                    <div class="header-name-row">
                        <span id="header-name">Nome do Herói</span>
                        <span id="header-info" class="header-sub">Raça Classe (Nív 1)</span>
                    </div>
                    <div class="header-stats-row">
                        <div class="header-hp-container">
                            <div id="header-hp-bar" class="header-hp-fill"></div>
                            <span id="header-hp-text">10/10</span>
                        </div>
                        <div class="header-ac-badge">
                            <i class="fas fa-shield-halved"></i>
                            <span id="header-ac-val">10</span>
                        </div>
                    </div>
                </div>
                <div class="char-switcher-container">
                    <button id="switch-char-btn" class="medieval-btn small"><i class="fas fa-exchange-alt"></i></button>
                    <div id="char-switcher-dropdown" class="char-switcher-dropdown hidden">
                        <div class="dropdown-header">
                            <strong>Trocar Personagem</strong>
                        </div>
                        <div class="dropdown-scroll-wrapper">
                            <i class="fas fa-chevron-up dropdown-scroll-arrow up hidden"></i>
                            <div id="char-switcher-list" class="char-switcher-list">
                                <!-- Populated by JS -->
                            </div>
                            <i class="fas fa-chevron-down dropdown-scroll-arrow down hidden"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="user-controls">
                <div class="custom-select-container" id="system-selector-container">
                    <div class="custom-select-trigger" id="system-selector-trigger">
                        <span id="system-selector-text">D&D 5ª Edição</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="custom-select-options-wrapper hidden" id="system-selector-options-wrapper">
                        <i class="fas fa-chevron-up dropdown-scroll-arrow up hidden"></i>
                        <div class="custom-select-options" id="system-selector-options">
                            <!-- Options populated by JS -->
                        </div>
                        <i class="fas fa-chevron-down dropdown-scroll-arrow down hidden"></i>
                    </div>
                    <input type="hidden" id="system-selector" value="dnd5e">
                </div>
                <div id="user-profile-actions" class="user-profile-actions hidden">
                    <button id="settings-btn" class="medieval-btn small icon-only" title="Configurações"><i
                            class="fas fa-cog"></i></button>
                    <button id="login-btn" class="medieval-btn small"><i class="fas fa-key"></i> Entrar</button>
                </div>
            </div>
        </div>
    </header>

    <nav id="side-menu" class="side-menu hidden">
        <div class="menu-overlay"></div>
        <div class="menu-content parchment">
            <button class="close-menu">&times;</button>

            <div class="menu-section" data-section="creation">
                <h3><i class="fas fa-hammer"></i> Criação Arcaica</h3>
                <div class="menu-grid">
                    <button class="nav-btn" data-view="fichas"><i class="fas fa-user-shield"></i> Personagens</button>
                    <button class="nav-btn" data-view="monstros"><i class="fas fa-dragon"></i> Bestiário</button>
                    <button class="nav-btn" data-view="armadilhas"><i class="fas fa-skull-crossbones"></i>
                        Armadilhas</button>
                    <button class="nav-btn" data-action="item-gen"><i class="fas fa-ring"></i> Itens Mágicos</button>
                    <button class="nav-btn" data-action="villain-gen"><i class="fas fa-mask"></i> Vilões</button>
                    <button class="nav-btn" data-action="npc-gen"><i class="fas fa-users-gear"></i> NPCs</button>
                </div>
            </div>

            <div class="menu-section" data-section="mestre">
                <h3><i class="fas fa-chess-board"></i> Mestre de Masmorras</h3>
                <div class="menu-grid">
                    <button class="nav-btn" data-action="gm-screen"><i class="fas fa-desktop"></i> Painel do
                        Mestre</button>
                    <button class="nav-btn" data-action="campaign-mgnt"><i class="fas fa-map-location-dot"></i>
                        Campanhas</button>
                    <button class="nav-btn" data-action="encounter-gen"><i class="fas fa-shield"></i> Encontros</button>
                    <button class="nav-btn" data-action="trap-gen"><i class="fas fa-skull-crossbones"></i>
                        Armadilhas</button>
                    <button class="nav-btn" data-action="puzzle-gen"><i class="fas fa-puzzle-piece"></i>
                        Puzzles</button>
                    <button class="nav-btn" data-action="treasure-gen"><i class="fas fa-coins"></i> Tesouros</button>
                </div>
            </div>

            <div class="menu-section" data-section="chronicles">
                <h3><i class="fas fa-journal-whills"></i> Trama & Saber</h3>
                <div class="menu-grid">
                    <button class="nav-btn" data-view="chat"><i class="fas fa-comment-dots"></i> Fale com Lyra</button>
                    <button class="nav-btn" data-view="sessoes"><i class="fas fa-scroll"></i> Sessões</button>
                    <button class="nav-btn" data-action="scene-desc"><i class="fas fa-image"></i> Cenas</button>
                    <button class="nav-btn" data-action="plot-gen"><i class="fas fa-wand-magic-sparkles"></i>
                        Tramas</button>
                    <button class="nav-btn" data-action="motivation-gen"><i class="fas fa-heart-pulse"></i>
                        Motivações</button>
                    <button class="nav-btn" data-action="rules-search"><i class="fas fa-book-open"></i> Regras</button>
                    <button class="nav-btn" data-action="names-list"><i class="fas fa-list-ol"></i> Nomes</button>
                </div>
            </div>
        </div>
    </nav>

    <main id="main-content">
        <!-- Dashboard View -->
        <section id="dashboard" class="view hidden">
            <div class="hero-section">
                <div class="hero-content-wrapper">
                    <div class="hero-artwork">
                        <img src="assets/Lyra_the_wise.png" alt="Lyra" class="hero-lyra">
                    </div>
                    <div class="lyra-story">
                        <div class="scroll-container">
                            <div class="scroll-paper">
                                <h3 class="scroll-title">Sabedoria Arcana</h3>
                                <p id="rpg-trivia">Consultando os anais do multiverso...</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="quick-actions">
                    <!-- Criação Arcaica -->
                    <button class="action-card" data-view="fichas">
                        <i class="fas fa-user-shield"></i>
                        <span>Personagens</span>
                    </button>
                    <button class="action-card" data-view="monstros">
                        <i class="fas fa-dragon"></i>
                        <span>Bestiário</span>
                    </button>
                    <button class="action-card" data-view="armadilhas">
                        <i class="fas fa-skull-crossbones"></i>
                        <span>Armadilhas</span>
                    </button>
                    <button class="action-card" data-action="villain-gen">
                        <i class="fas fa-mask"></i>
                        <span>Vilões</span>
                    </button>
                    <button class="action-card" data-action="npc-gen">
                        <i class="fas fa-users-gear"></i>
                        <span>NPCs</span>
                    </button>
                    <button class="action-card" data-action="item-gen">
                        <i class="fas fa-ring"></i>
                        <span>Itens Mágicos</span>
                    </button>

                    <!-- Mestre de Masmorras -->
                    <button class="action-card" data-action="gm-screen">
                        <i class="fas fa-desktop"></i>
                        <span>Painel do Mestre</span>
                    </button>
                    <button class="action-card" data-action="campaign-mgnt">
                        <i class="fas fa-map-location-dot"></i>
                        <span>Campanhas</span>
                    </button>
                    <button class="action-card" data-action="encounter-gen">
                        <i class="fas fa-shield"></i>
                        <span>Encontros</span>
                    </button>
                    <button class="action-card" data-action="puzzle-gen">
                        <i class="fas fa-puzzle-piece"></i>
                        <span>Puzzles</span>
                    </button>
                    <button class="action-card" data-action="treasure-gen">
                        <i class="fas fa-coins"></i>
                        <span>Tesouros</span>
                    </button>

                    <!-- Trama & Saber -->
                    <button class="action-card" data-view="chat">
                        <i class="fas fa-comment-dots"></i>
                        <span>Fale com Lyra</span>
                    </button>
                    <button class="action-card" data-view="sessoes">
                        <i class="fas fa-scroll"></i>
                        <span>Sessões</span>
                    </button>
                    <button class="action-card" data-action="scene-desc">
                        <i class="fas fa-image"></i>
                        <span>Cenas</span>
                    </button>
                    <button class="action-card" data-action="plot-gen">
                        <i class="fas fa-wand-magic-sparkles"></i>
                        <span>Tramas</span>
                    </button>
                    <button class="action-card" data-action="motivation-gen">
                        <i class="fas fa-heart-pulse"></i>
                        <span>Motivações</span>
                    </button>
                    <button class="action-card" data-action="rules-search">
                        <i class="fas fa-book-open"></i>
                        <span>Regras</span>
                    </button>
                    <button class="action-card" data-action="names-list">
                        <i class="fas fa-list-ol"></i>
                        <span>Nomes</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Chat View -->
        <section id="chat" class="view hidden">
            <div class="chat-container parchment">
                <div class="chat-header">
                    <h2><i class="fas fa-scroll"></i> Pergunte à Lyra</h2>
                    <button id="chat-close-btn" class="chat-close-btn medieval-btn small icon-only" title="Fechar Chat">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="chat-messages" class="chat-messages"></div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" placeholder="Sua mensagem, viajante...">
                    <button id="send-msg-btn" class="medieval-btn small">Enviar</button>
                </div>
            </div>
        </section>

        <!-- Fichas View -->
        <section id="fichas" class="view hidden">
            <div class="view-header">
                <h2><i class="fas fa-user-shield"></i> Seus Personagens</h2>
                <div class="header-actions">
                    <button id="bulk-delete-fichas-btn" class="medieval-btn small secondary"><i
                            class="fas fa-trash-can"></i>
                        Excluir</button>
                    <button id="show-wizard-btn" class="medieval-btn small"><i class="fas fa-plus"></i>
                        Novo</button>
                </div>
            </div>
            <div id="fichas-list" class="items-grid"></div>
        </section>

        <!-- Monstros View -->
        <section id="monstros" class="view hidden">
            <div class="view-header">
                <h2><i class="fas fa-dragon"></i> Bestiário Arcano</h2>
                <div class="header-actions">
                    <button id="show-monster-btn" class="medieval-btn small"><i class="fas fa-magic"></i>
                        Invocar</button>
                </div>
            </div>
            <div id="monsters-list" class="items-grid"></div>
        </section>

        <!-- Armadilhas View -->
        <section id="armadilhas" class="view hidden">
            <div class="view-header">
                <h2><i class="fas fa-skull-crossbones"></i> Armadilhas & Perigos</h2>
                <div class="header-actions">
                    <button id="show-trap-btn" class="medieval-btn small"><i class="fas fa-plus"></i> Nova</button>
                </div>
            </div>
            <div id="traps-list" class="items-grid"></div>
        </section>

        <!-- Sessoes View -->
        <section id="sessoes" class="view hidden">
            <div class="view-header">
                <h2><i class="fas fa-feather-pointed"></i> Diários de Sessão</h2>
                <button id="show-session-btn" class="medieval-btn small"><i class="fas fa-pen-nib"></i>
                    Escrever</button>
            </div>
            <div id="sessions-list" class="items-grid"></div>
        </section>
    </main>

    <!-- Menu de Confirmação Customizado -->
    <div id="confirm-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content medieval-scroll-bg confirm-box">
            <h2 id="confirm-title" class="scroll-title">Aviso do Destino</h2>
            <p id="confirm-message" class="confirm-text">Deseja prosseguir com esta ação?</p>
            <div class="confirm-actions">
                <button id="confirm-cancel-btn" class="medieval-btn secondary">Voltar</button>
                <button id="confirm-ok-btn" class="medieval-btn">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Modals & Wizards -->
    <div id="modal-wrapper" class="hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content parchment">
            <button class="close-modal"><i class="fas fa-xmark"></i></button>
            <div id="detail-container" class="hidden"></div> <!-- Added detail container -->
            <div id="modal-body">
                <!-- Painel de Configurações Arcanas -->
                <div id="settings-modal" class="wizard-container hidden">
                    <h2 class="scroll-title">Ajustes do Perfil</h2>
                    <div class="settings-content">
                        <div class="form-group">
                            <label>Apelido Arcano</label>
                            <input type="text" id="setting-nickname" class="medieval-input"
                                placeholder="Seu nome de aventureiro">
                        </div>
                        <div class="form-group">
                            <label>WhatsApp (Opcional)</label>
                            <input type="text" id="setting-whatsapp" class="medieval-input"
                                placeholder="Para contato entre guildas">
                        </div>
                        <div class="form-group">
                            <label>Descrição do Aventureiro</label>
                            <textarea id="setting-bio" class="medieval-textarea"
                                placeholder="Conte sua lenda..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Arsenal de Cursores</label>
                            <div class="cursor-grid" id="cursor-selector">
                                <!-- Swords -->
                                <div class="cursor-option" data-cursor="sword-gold" title="Espada Dourada"><img
                                        src="assets/cursors/sword_gold.png"></div>
                                <div class="cursor-option" data-cursor="sword-silver" title="Espada de Prata"><img
                                        src="assets/cursors/sword_silver.png"></div>
                                <div class="cursor-option" data-cursor="sword-crimson" title="Lâmina Carmesim"><img
                                        src="assets/cursors/sword_crimson.png"></div>
                                <div class="cursor-option" data-cursor="sword-shadow" title="Espada Sombria"><img
                                        src="assets/cursors/sword_shadow.png"></div>
                                <div class="cursor-option" data-cursor="sword-emerald" title="Lâmina de Esmeralda"><img
                                        src="assets/cursors/sword_emerald.png"></div>
                                <!-- Staffs -->
                                <div class="cursor-option" data-cursor="staff-crystal" title="Cajado de Cristal"><img
                                        src="assets/cursors/staff_crystal.png"></div>
                                <div class="cursor-option" data-cursor="staff-sunlight" title="Cajado Solar"><img
                                        src="assets/cursors/staff_sunlight.png"></div>
                                <div class="cursor-option" data-cursor="staff-lunar" title="Cajado Lunar"><img
                                        src="assets/cursors/staff_lunar.png"></div>
                                <div class="cursor-option" data-cursor="staff-shadow" title="Cajado Sombrio"><img
                                        src="assets/cursors/staff_shadow.png"></div>
                                <div class="cursor-option" data-cursor="staff-emerald" title="Cajado de Esmeralda"><img
                                        src="assets/cursors/staff_emerald.png"></div>
                                <!-- Potions -->
                                <div class="cursor-option" data-cursor="potion-red" title="Poção de Vida"><img
                                        src="assets/cursors/potion_red.png"></div>
                                <div class="cursor-option" data-cursor="potion-blue" title="Poção de Mana"><img
                                        src="assets/cursors/potion_blue.png"></div>
                            </div>
                        </div>
                        <div class="settings-actions">
                            <button id="save-settings-btn" class="medieval-btn">Consagrar Alterações</button>
                        </div>
                    </div>
                </div>

                <!-- Wizard Steps (Characters) -->
                <div id="creation-wizard" class="wizard-container hidden">
                    <div id="char-choice-step" class="wizard-step" data-step="0">
                        <h3>Como deseja criar, viajante?</h3>
                        <div class="mode-choices">
                            <div class="choice-card" data-mode="ai">
                                <i class="fas fa-wand-magic-sparkles"></i>
                                <h4>Com Lyra</h4>
                                <p>A IA tecerá os detalhes arcanos para você.</p>
                            </div>
                            <div class="choice-card" data-mode="manual">
                                <i class="fas fa-feather-pointed"></i>
                                <h4>Manualmente</h4>
                                <p>Você mesmo escreve cada detalhe da sua história.</p>
                            </div>
                        </div>
                    </div>
                    <div class="wizard-progress hidden">
                        <div class="step-indicator active" data-step="1">1</div>
                        <div class="step-indicator" data-step="2">2</div>
                        <div class="step-indicator" data-step="3">3</div>
                        <div class="step-indicator" data-step="4">4</div>
                        <div class="step-indicator" data-step="5">5</div>
                    </div>
                    <!-- Steps content... same as before -->
                    <div class="wizard-step" data-step="1">
                        <h3>Origens</h3>
                        <div class="form-group"><label>Nome do Herói</label><input type="text" id="wiz-name"
                                placeholder="Ex: Valerius"></div>
                        <div class="form-row">
                            <div class="form-group"><label>Raça</label><input type="text" id="wiz-race"
                                    placeholder="Ex: Humano" required></div>
                            <div class="form-group">
                                <label>Classe</label>
                                <select id="wiz-class" class="medieval-select" required>
                                    <option value="">Selecione...</option>
                                    <option value="Bárbaro">Bárbaro</option>
                                    <option value="Bardo">Bardo</option>
                                    <option value="Bruxo">Bruxo</option>
                                    <option value="Clérigo">Clérigo</option>
                                    <option value="Druida">Druida</option>
                                    <option value="Feiticeiro">Feiticeiro</option>
                                    <option value="Guerreiro">Guerreiro</option>
                                    <option value="Ladino">Ladino</option>
                                    <option value="Mago">Mago</option>
                                    <option value="Monge">Monge</option>
                                    <option value="Paladino">Paladino</option>
                                    <option value="Patrulheiro">Patrulheiro</option>
                                    <option value="Artífice">Artífice</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Alinhamento</label>
                                <select id="wiz-alignment" class="medieval-select">
                                    <option value="Leal e Bom">Leal e Bom</option>
                                    <option value="Neutro e Bom">Neutro e Bom</option>
                                    <option value="Caótico e Bom">Caótico e Bom</option>
                                    <option value="Leal e Neutro">Leal e Neutro</option>
                                    <option value="Neutro">Neutro</option>
                                    <option value="Caótico e Neutro">Caótico e Neutro</option>
                                    <option value="Leal e Mau">Leal e Mau</option>
                                    <option value="Neutro e Mau">Neutro e Mau</option>
                                    <option value="Caótico e Mau">Caótico e Mau</option>
                                </select>
                            </div>
                            <div class="form-group"><label>Velocidade (m)</label><input type="text" id="wiz-speed"
                                    value="9m"></div>
                        </div>
                        <div class="form-group"><label>Antecedente</label><input type="text" id="wiz-background"
                                placeholder="Ex: Acólito"></div>
                    </div>
                    <div class="wizard-step hidden" data-step="2">
                        <h3>Atributos</h3>
                        <div class="attributes-grid">
                            <div class="attr-input"><span>FOR</span><input type="number" id="wiz-str" value="10"></div>
                            <div class="attr-input"><span>DEX</span><input type="number" id="wiz-dex" value="10"></div>
                            <div class="attr-input"><span>CON</span><input type="number" id="wiz-con" value="10"></div>
                            <div class="attr-input"><span>INT</span><input type="number" id="wiz-int" value="10"></div>
                            <div class="attr-input"><span>WIS</span><input type="number" id="wiz-wis" value="10"></div>
                            <div class="attr-input"><span>CHA</span><input type="number" id="wiz-cha" value="10"></div>
                        </div>
                    </div>
                    <div class="wizard-step hidden" data-step="3">
                        <h3>Perícias</h3>
                        <div class="skills-selection">
                            <label><input type="checkbox" value="Acrobacia"> Acrobacia</label>
                            <label><input type="checkbox" value="Adestramento de Animais"> Adestramento</label>
                            <label><input type="checkbox" value="Arcanismo"> Arcanismo</label>
                            <label><input type="checkbox" value="Atletismo"> Atletismo</label>
                            <label><input type="checkbox" value="Atuação"> Atuação</label>
                            <label><input type="checkbox" value="Blefar"> Blefar</label>
                            <label><input type="checkbox" value="Furtividade"> Furtividade</label>
                            <label><input type="checkbox" value="História"> História</label>
                            <label><input type="checkbox" value="Intimidação"> Intimidação</label>
                            <label><input type="checkbox" value="Intuição"> Intuição</label>
                            <label><input type="checkbox" value="Investigação"> Investigação</label>
                            <label><input type="checkbox" value="Medicina"> Medicina</label>
                            <label><input type="checkbox" value="Natureza"> Natureza</label>
                            <label><input type="checkbox" value="Percepção"> Percepção</label>
                            <label><input type="checkbox" value="Persuasão"> Persuasão</label>
                            <label><input type="checkbox" value="Prestidigitação"> Prestidigitação</label>
                            <label><input type="checkbox" value="Religião"> Religião</label>
                            <label><input type="checkbox" value="Sobrevivência"> Sobrevivência</label>
                        </div>
                    </div>
                    <div class="wizard-step hidden" data-step="4">
                        <h3>Crônicas e Personalidade</h3>
                        <div class="form-group"><label>Traços de Personalidade</label><textarea id="wiz-traits"
                                class="medieval-textarea"
                                placeholder="Ex: Eu sempre tenho um plano para quando as coisas dão errado."></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>Ideais</label><textarea id="wiz-ideals"
                                    class="medieval-textarea"
                                    placeholder="Ex: Respeito. As pessoas merecem ser tratadas com dignidade."></textarea>
                            </div>
                            <div class="form-group"><label>Vínculos</label><textarea id="wiz-bonds"
                                    class="medieval-textarea"
                                    placeholder="Ex: Tudo o que faço é pela minha família."></textarea></div>
                        </div>
                        <div class="form-group"><label>Defeitos</label><textarea id="wiz-flaws"
                                class="medieval-textarea"
                                placeholder="Ex: Eu me distraio facilmente com promessas de ouro."></textarea></div>
                        <div class="form-row">
                            <div class="form-group"><label>Maneirismos (Mestre)</label><textarea id="wiz-mannerisms"
                                    class="medieval-textarea"
                                    placeholder="Ex: Vive batendo os dedos na mesa ou puxando o lóbulo da orelha."></textarea>
                            </div>
                            <div class="form-group"><label>Talentos de Roleplay</label><textarea id="wiz-talents"
                                    class="medieval-textarea"
                                    placeholder="Ex: Sabe imitar perfeitamente o som de um pássaro regional."></textarea>
                            </div>
                        </div>
                        <div class="form-group"><label>Aparência do Personagem</label><textarea id="wiz-appearance"
                                class="medieval-textarea"
                                placeholder="Descreva traços físicos, vestimentas e itens marcantes."></textarea>
                        </div>
                        <div class="form-group"><label>História do Personagem</label><textarea id="wiz-backstory"
                                class="medieval-textarea"
                                placeholder="Sua jornada até aqui... (Lyra pode preencher se você escolher o modo IA)"></textarea>
                        </div>
                    </div>

                    <div class="wizard-step hidden" data-step="5">
                        <h3>Consagração</h3>
                        <p id="wiz-final-msg">Lyra irá tecer a trama final do seu herói.</p>
                    </div>

                    <div class="wizard-nav">
                        <button id="wiz-prev" class="medieval-btn small secondary hidden">Anterior</button>
                        <button id="wiz-next" class="medieval-btn small">Próximo</button>
                        <button id="wiz-finish" class="medieval-btn small hidden">Consagrar</button>
                    </div>
                </div>

                <!-- Monster Wizard -->
                <div id="monster-wizard" class="wizard-container hidden">
                    <div id="mon-choice-step" class="wizard-step">
                        <h3>Origem da Criatura</h3>
                        <div class="mode-choices">
                            <div class="choice-card" data-mode="ai">
                                <i class="fas fa-dragon"></i>
                                <h4>Invocar com Lyra</h4>
                                <p>A IA gerará as estatísticas e a descrição.</p>
                            </div>
                            <div class="choice-card" data-mode="manual">
                                <i class="fas fa-hammer"></i>
                                <h4>Forjar Manualmente</h4>
                                <p>Preencha os detalhes da criatura você mesmo.</p>
                            </div>
                        </div>
                    </div>
                    <div id="mon-form" class="hidden">
                        <h3><i class="fas fa-dragon"></i> Invocação de Criatura</h3>
                        <div class="form-group"><label>Nome</label><input type="text" id="mon-name"></div>
                        <div class="form-row">
                            <div class="form-group"><label>ND</label><input type="text" id="mon-cr"></div>
                            <div class="form-group"><label>Tipo</label><input type="text" id="mon-type"></div>
                        </div>
                        <div class="form-group"><label>Descrição/Prompt</label><textarea id="mon-prompt"
                                class="medieval-textarea"
                                placeholder="Ex: Um lobo das sombras com olhos flamejantes..."></textarea></div>
                        <div class="wizard-nav">
                            <button id="mon-finish-btn" class="medieval-btn small">Invocar</button>
                        </div>
                    </div>
                </div>

                <!-- Session Wizard -->
                <div id="session-wizard" class="wizard-container hidden">
                    <div id="sess-choice-step" class="wizard-step">
                        <h3>Registro da Crônica</h3>
                        <div class="mode-choices">
                            <div class="choice-card" data-mode="ai">
                                <i class="fas fa-scroll"></i>
                                <h4>Escriba Lyra</h4>
                                <p>A IA organizará seus pensamentos em um diário.</p>
                            </div>
                            <div class="choice-card" data-mode="manual">
                                <i class="fas fa-pen-nib"></i>
                                <h4>Própria Pena</h4>
                                <p>Escreva sua própria crônica de aventura.</p>
                            </div>
                        </div>
                    </div>
                    <div id="sess-form" class="hidden">
                        <h3><i class="fas fa-feather-pointed"></i> Crônicas de Sessão</h3>
                        <div class="form-group"><label>Título da Aventura</label><input type="text" id="sess-title">
                        </div>
                        <div class="form-group"><label>Resumo da Jornada</label><textarea id="sess-summary"
                                class="medieval-textarea" placeholder="O que aconteceu nesta sessão?"></textarea>
                        </div>
                        <div class="form-group"><label>Notas do Mestre</label><textarea id="sess-notes"
                                class="medieval-textarea" placeholder="Segredos, ganchos futuros..."></textarea>
                        </div>
                        <div class="wizard-nav">
                            <button id="sess-finish-btn" class="medieval-btn small">Registrar</button>
                        </div>
                    </div>
                </div>

                <!-- Character Sheet -->
                <div id="character-sheet" class="sheet-container hidden">
                    <div class="sheet-header">
                        <div class="header-main-info">
                            <div class="char-token-wrapper">
                                <img id="sheet-token" src="assets/Lyra_Token.png" alt="Token" class="char-token">
                                <input type="file" id="token-upload" accept="image/*" class="hidden">
                                <label for="token-upload" id="token-upload-btn" class="token-upload-overlay hidden">
                                    <i class="fas fa-camera"></i>
                                </label>
                            </div>
                            <div class="char-name-info">
                                <h2 id="sheet-char-name"></h2>
                                <div id="sheet-char-info" class="char-subtitle"></div>
                            </div>
                        </div>
                        <div class="sheet-actions">
                            <button id="edit-sheet-btn" class="medieval-btn small"><i
                                    class="fas fa-feather-pointed"></i> Editar</button>
                            <button id="cancel-sheet-btn" class="medieval-btn small secondary hidden"><i
                                    class="fas fa-times"></i>
                                Cancelar</button>
                            <button id="save-sheet-btn" class="medieval-btn small hidden"><i class="fas fa-save"></i>
                                Salvar</button>
                        </div>
                    </div>
                    <div class="sheet-tabs">
                        <button class="sheet-tab active" data-tab="geral">Principal</button>
                        <button class="sheet-tab" data-tab="combate">Combate</button>
                        <button class="sheet-tab" data-tab="magia">Grimório</button>
                        <button class="sheet-tab" data-tab="inventario">Mochila</button>
                        <button class="sheet-tab" data-tab="historia">Crônicas</button>
                    </div>
                    <div class="sheet-content">
                        <!-- Aba Geral: Bio, Atributos, Resistências e Perícias -->
                        <div id="sheet-geral" class="sheet-section">
                            <div class="bio-grid">
                                <div class="form-group"><label>Antecedente</label><span id="sheet-background"
                                        class="editable" data-field="bio.background"></span></div>
                                <div class="form-group"><label>Alinhamento</label><span id="sheet-alignment"
                                        class="editable" data-field="bio.alignment"></span></div>
                                <div class="form-group"><label>XP</label><span id="sheet-xp" class="editable"
                                        data-field="bio.xp"></span></div>
                                <div class="form-group"><label>Nome do Jogador</label><span id="sheet-player-name"
                                        class="editable" data-field="bio.playerName"></span></div>
                            </div>
                            <div class="stats-main-grid">
                                <div class="attributes-column">
                                    <div class="scores-grid" id="sheet-scores"></div>
                                    <h4 class="section-title">Testes de Resistência</h4>
                                    <div class="saves-list" id="sheet-saves"></div>
                                </div>
                                <div class="skills-column">
                                    <div class="top-vitals-row">
                                        <div class="vital-mini-box"><span>Proficiência</span><strong
                                                id="sheet-prof"></strong></div>
                                        <div class="vital-mini-box"><span>Percepção Passiva</span><strong
                                                id="sheet-passive-percep"></strong></div>
                                    </div>
                                    <h4 class="section-title">Perícias</h4>
                                    <div class="skills-list" id="sheet-skills"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Aba Combate: PV, CA, Iniciativa, Ataques, Death Saves -->
                        <div id="sheet-combate" class="sheet-section hidden">
                            <div class="combat-status-grid">
                                <div class="vital-box large"><span>CA</span><strong id="sheet-ca" class="editable"
                                        data-field="stats.ac">10</strong></div>
                                <div class="vital-box large"><span>Iniciativa</span><strong id="sheet-inic"
                                        class="editable" data-field="stats.initiative">0</strong></div>
                                <div class="vital-box large"><span>Velocidade</span><strong id="sheet-speed"
                                        class="editable" data-field="stats.speed">9m</strong></div>
                                <div class="hp-container-main">
                                    <div class="hp-box-full">
                                        <span class="label">Pontos de Vida</span>
                                        <div class="hp-controls">
                                            <input type="number" id="sheet-hp-curr" class="hp-input"
                                                data-field="stats.hp_current">
                                            <span class="sep">/</span>
                                            <input type="number" id="sheet-hp-max" class="hp-input"
                                                data-field="stats.hp_max">
                                        </div>
                                    </div>
                                    <div class="hp-temp">
                                        <span>PV Temporários</span>
                                        <input type="number" id="sheet-hp-temp" class="hp-input small"
                                            data-field="stats.hp_temp">
                                    </div>
                                </div>
                            </div>

                            <div class="combat-details-grid">
                                <div class="hit-dice-death-saves">
                                    <div class="hit-dice-block">
                                        <h4>Dados de Vida</h4>
                                        <div class="hit-dice-row">
                                            <input type="number" id="sheet-hd-curr" data-field="stats.hit_dice_current">
                                            <span> de </span>
                                            <span id="sheet-hd-total" class="editable"
                                                data-field="stats.hit_dice_total">1d8</span>
                                        </div>
                                    </div>
                                    <div class="death-saves-block">
                                        <h4>Resistência à Morte</h4>
                                        <div class="death-row successes">Sucessos
                                            <input type="checkbox" id="death-s1" data-field="death_saves.successes"
                                                value="1">
                                            <input type="checkbox" id="death-s2" data-field="death_saves.successes"
                                                value="2">
                                            <input type="checkbox" id="death-s3" data-field="death_saves.successes"
                                                value="3">
                                        </div>
                                        <div class="death-row failures">Falhas
                                            <input type="checkbox" id="death-f1" data-field="death_saves.failures"
                                                value="1">
                                            <input type="checkbox" id="death-f2" data-field="death_saves.failures"
                                                value="2">
                                            <input type="checkbox" id="death-f3" data-field="death_saves.failures"
                                                value="3">
                                        </div>
                                    </div>
                                </div>
                                <div class="attacks-section">
                                    <h4 class="section-title">Ataques</h4>
                                    <div id="attacks-body" class="attacks-list-v2"></div>
                                    <button id="add-attack-btn" class="medieval-btn small secondary"><i
                                            class="fas fa-plus"></i> Adicionar Arma</button>
                                </div>
                            </div>
                        </div>

                        <!-- Aba Magia: Slots, Grimório, CD -->
                        <div id="sheet-magia" class="sheet-section hidden">
                            <div class="magic-header-stats">
                                <div class="vital-box"><span>CD Salva.</span><strong id="sheet-spell-dc">8</strong>
                                </div>
                                <div class="vital-box"><span>Ataque Mág.</span><strong id="sheet-spell-atk">0</strong>
                                </div>
                                <div class="form-group"><label>Atributo de Conjuração</label><select
                                        id="sheet-spell-attr" data-field="spells.ability" class="wizard-select">
                                        <option value="int">Inteligência</option>
                                        <option value="wis">Sabedoria</option>
                                        <option value="cha">Carisma</option>
                                    </select></div>
                            </div>
                            <div class="spell-slots-tracker" id="sheet-spell-slots"></div>
                            <h4 class="section-title">Livro de Magias</h4>
                            <div id="spells-body" class="spells-list-v2"></div>
                            <button id="add-spell-btn" class="medieval-btn small secondary"><i
                                    class="fas fa-wand-sparkles"></i> Adicionar Magia</button>
                        </div>

                        <!-- Aba Inventário: Itens, Moedas, Carga -->
                        <div id="sheet-inventario" class="sheet-section hidden">
                            <div class="inventory-top-grid">
                                <div class="coins-pouch">
                                    <h4>Bolsa de Moedas</h4>
                                    <div class="coins-grid">
                                        <div class="coin-item pc"><span>PC</span><input type="number"
                                                data-field="inventory.coins.pc"></div>
                                        <div class="coin-item pp"><span>PP</span><input type="number"
                                                data-field="inventory.coins.pp"></div>
                                        <div class="coin-item pe"><span>PE</span><input type="number"
                                                data-field="inventory.coins.pe"></div>
                                        <div class="coin-item po"><span>PO</span><input type="number"
                                                data-field="inventory.coins.po"></div>
                                        <div class="coin-item pl"><span>PL</span><input type="number"
                                                data-field="inventory.coins.pl"></div>
                                    </div>
                                </div>
                                <div class="encumbrance-tracker">
                                    <h4 class="section-title">Carga</h4>
                                    <div class="weight-bar">
                                        <div id="weight-progress" class="bar"></div><span id="weight-text">0 / 0
                                            lbs</span>
                                    </div>
                                </div>
                            </div>
                            <h4 class="section-title">Equipamentos & Tesouros</h4>
                            <div id="inventory-body" class="inventory-list-v2"></div>
                            <button id="add-item-btn" class="medieval-btn small secondary"><i
                                    class="fas fa-box-open"></i> Adicionar Item</button>
                        </div>

                        <!-- Aba História: Notas, Traços, Exaustão -->
                        <div id="sheet-historia" class="sheet-section hidden">
                            <div class="traits-full-grid">
                                <div class="form-group"><label>Traços de Personalidade</label><textarea
                                        data-field="story.traits" class="medieval-textarea"></textarea></div>
                                <div class="form-group"><label>Ideais</label><textarea data-field="story.ideals"
                                        class="medieval-textarea"></textarea></div>
                                <div class="form-group"><label>Vínculos</label><textarea data-field="story.bonds"
                                        class="medieval-textarea"></textarea></div>
                                <div class="form-group"><label>Defeitos</label><textarea data-field="story.flaws"
                                        class="medieval-textarea"></textarea></div>
                                <div class="form-group"><label>Maneirismos</label><textarea
                                        data-field="story.mannerisms" class="medieval-textarea"></textarea></div>
                                <div class="form-group"><label>Talento de Interpretação</label><textarea
                                        data-field="story.talents" class="medieval-textarea"></textarea></div>
                            </div>
                            <div class="chronic-notes">
                                <h4 class="section-title">Aparência & História</h4>
                                <textarea data-field="story.appearance" class="medieval-textarea"
                                    placeholder="Aparência física..."></textarea>
                                <textarea data-field="story.notes" class="medieval-textarea large"
                                    placeholder="Suas crônicas escritas nas estrelas..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Custom Alert Modal -->
    <div id="alert-modal" class="modal-overlay hidden">
        <div class="medieval-modal alert-content">
            <div class="lyra-corner top-left"></div>
            <div class="lyra-corner top-right"></div>
            <div class="alert-body">
                <i class="fa-solid fa-scroll alert-icon"></i>
                <h3 id="alert-title">Decreto Real</h3>
                <p id="alert-message"></p>
            </div>
            <div class="modal-footer">
                <button class="medieval-btn" onclick="app.closeAlert()">Ciente</button>
            </div>
        </div>
    </div>

    <!-- Scroll Indicators -->
    <div id="scroll-up" class="scroll-indicator hidden">
        <i class="fa-solid fa-chevron-up"></i>
    </div>
    <div id="scroll-down" class="scroll-indicator">
        <i class="fa-solid fa-chevron-down"></i>
    </div>

    <script src="js/app.js" type="module"></script>

    <!-- Mystical Loading Overlay -->
    <div id="mystic-loading" class="hidden">
        <div class="mystic-spinner">
            <div class="rune-layer outer"></div>
            <div class="rune-layer"></div>
            <div class="rune-layer inner"></div>
        </div>
        <div class="loading-text">Tecendo a Trama...</div>
    </div>
</body>

</html>